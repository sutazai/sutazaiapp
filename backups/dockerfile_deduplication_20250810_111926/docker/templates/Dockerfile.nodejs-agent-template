# SutazAI Node.js Agent Service Template
# This template generates Node.js service-specific Dockerfiles
# Author: DevOps Manager - Deduplication Operation
# Date: August 10, 2025

FROM sutazai-nodejs-agent-master:latest

# Service-specific metadata
LABEL service.name="{{SERVICE_NAME}}" \
      service.port="{{SERVICE_PORT}}" \
      service.description="{{SERVICE_DESC}}" \
      service.type="nodejs-agent" \
      build.date="$(date -u +'%Y-%m-%dT%H:%M:%SZ')" \
      build.version="v1.0.0"

# Copy service-specific package.json if it exists
COPY package*.json ./
RUN if [ -f package.json ]; then \
        npm ci --only=production; \
    fi

# Copy service source code  
COPY . /app/

# Set service-specific environment variables
ENV SERVICE_NAME={{SERVICE_NAME}} \
    SERVICE_PORT={{SERVICE_PORT}} \
    PORT={{SERVICE_PORT}} \
    OLLAMA_BASE_URL=http://ollama:11434 \
    OPENAI_API_BASE=http://ollama:11434/v1 \
    OPENAI_API_KEY=local

# Expose service port
EXPOSE {{SERVICE_PORT}}

# Override health check for service-specific endpoint
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:{{SERVICE_PORT}}/health || exit 1

# Service-specific startup command
CMD ["node", "index.js"]