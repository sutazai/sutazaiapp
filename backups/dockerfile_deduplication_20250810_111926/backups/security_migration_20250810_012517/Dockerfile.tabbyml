FROM tabbyml/tabby:latest

ENV TABBY_MODEL=TabbyML/StarCoder-1B
ENV TABBY_DEVICE=cpu

EXPOSE 8080


# Run as non-root user
USER nobody

# Security: Create non-root user
RUN groupadd -r appuser && useradd -r -g appuser appuser \
    && mkdir -p /app && chown -R appuser:appuser /app
USER appuser

CMD ["serve", "--model", "${TABBY_MODEL}", "--device", "${TABBY_DEVICE}", "--no-webserver"]
