groups:
  # AI Model Performance Alerts
  - name: ai_model_performance
    rules:
    - alert: OllamaModelLoadFailure
      expr: ollama_model_load_failures_total > 0
      for: 1m
      labels:
        severity: critical
        component: ai_models
      annotations:
        summary: "Ollama model load failure"
        description: "Failed to load AI model in Ollama service"

    - alert: OllamaHighLatency
      expr: histogram_quantile(0.95, rate(ollama_request_duration_seconds_bucket[5m])) > 30
      for: 10m
      labels:
        severity: warning
        component: ai_models
      annotations:
        summary: "High AI model inference latency"
        description: "95th percentile inference time is above 30 seconds"

    - alert: OllamaHighErrorRate
      expr: rate(ollama_errors_total[5m]) / rate(ollama_requests_total[5m]) > 0.1
      for: 5m
      labels:
        severity: critical
        component: ai_models
      annotations:
        summary: "High error rate in AI model service"
        description: "Error rate is above 10% for AI model inference"

    - alert: OllamaModelMemoryExhaustion
      expr: ollama_model_memory_usage_bytes / ollama_model_memory_limit_bytes > 0.9
      for: 5m
      labels:
        severity: warning
        component: ai_models
      annotations:
        summary: "AI model memory exhaustion"
        description: "AI model memory usage is above 90%"

    - alert: ModelAccuracyDrop
      expr: ai_model_accuracy < 0.8
      for: 15m
      labels:
        severity: warning
        component: ai_models
      annotations:
        summary: "AI model accuracy drop detected"
        description: "Model accuracy has dropped below 80%"

  # AI Agent Health Alerts
  - name: ai_agent_health
    rules:
    - alert: AgentTaskQueueBacklog
      expr: ai_agent_task_queue_size > 100
      for: 10m
      labels:
        severity: warning
        component: ai_agents
      annotations:
        summary: "Agent task queue backlog"
        description: "Agent {{ $labels.agent_name }} has over 100 pending tasks"

    - alert: AgentResponseTimeout
      expr: increase(ai_agent_timeouts_total[5m]) > 5
      for: 5m
      labels:
        severity: warning
        component: ai_agents
      annotations:
        summary: "High agent timeout rate"
        description: "Agent {{ $labels.agent_name }} has experienced multiple timeouts"

    - alert: AgentCrashLoop
      expr: rate(ai_agent_restarts_total[10m]) > 0.1
      for: 5m
      labels:
        severity: critical
        component: ai_agents
      annotations:
        summary: "Agent crash loop detected"
        description: "Agent {{ $labels.agent_name }} is restarting frequently"

    - alert: AgentUnresponsive
      expr: time() - ai_agent_last_heartbeat > 300
      for: 5m
      labels:
        severity: critical
        component: ai_agents
      annotations:
        summary: "Agent unresponsive"
        description: "Agent {{ $labels.agent_name }} has not sent heartbeat for 5+ minutes"

  # Vector Database Performance
  - name: vector_db_performance
    rules:
    - alert: VectorSearchLatencyHigh
      expr: histogram_quantile(0.95, rate(vector_search_duration_seconds_bucket[5m])) > 5
      for: 10m
      labels:
        severity: warning
        component: vector_db
      annotations:
        summary: "High vector search latency"
        description: "Vector search latency is above 5 seconds"

    - alert: EmbeddingGenerationFailure
      expr: rate(embedding_generation_failures_total[5m]) > 0.05
      for: 5m
      labels:
        severity: warning
        component: vector_db
      annotations:
        summary: "High embedding generation failure rate"
        description: "Embedding generation failing at rate above 5%"

    - alert: VectorIndexCorruption
      expr: vector_index_integrity_check == 0
      for: 1m
      labels:
        severity: critical
        component: vector_db
      annotations:
        summary: "Vector index corruption detected"
        description: "Vector database index integrity check failed"

  # Business Logic Alerts
  - name: business_logic
    rules:
    - alert: UserSessionAbnormalPattern
      expr: rate(user_sessions_created[1h]) < 0.1 * rate(user_sessions_created[1h] offset 1d)
      for: 30m
      labels:
        severity: warning
        component: business
      annotations:
        summary: "Abnormal user session pattern"
        description: "User sessions are 90% below normal daily pattern"

    - alert: APIRateLimitExceeded
      expr: rate(api_rate_limit_exceeded_total[5m]) > 10
      for: 5m
      labels:
        severity: warning
        component: business
      annotations:
        summary: "High API rate limit violations"
        description: "API rate limit exceeded more than 10 times per minute"

    - alert: DataPipelineFailure
      expr: data_pipeline_success_rate < 0.95
      for: 10m
      labels:
        severity: critical
        component: business
      annotations:
        summary: "Data pipeline failure rate high"
        description: "Data pipeline success rate below 95%"

  # Security Alerts
  - name: security_alerts
    rules:
    - alert: UnauthorizedAccess
      expr: rate(http_requests_total{status="401"}[5m]) > 5
      for: 5m
      labels:
        severity: warning
        component: security
      annotations:
        summary: "High unauthorized access attempts"
        description: "More than 5 unauthorized access attempts per minute"

    - alert: SuspiciousAPIActivity
      expr: rate(http_requests_total[1m]) > 100
      for: 5m
      labels:
        severity: warning
        component: security
      annotations:
        summary: "Suspicious API activity detected"
        description: "Unusually high API request rate detected"

    - alert: ModelPoisoningAttempt
      expr: ai_model_input_anomaly_score > 0.9
      for: 1m
      labels:
        severity: critical
        component: security
      annotations:
        summary: "Potential model poisoning attempt"
        description: "Detected input with high anomaly score to AI model"