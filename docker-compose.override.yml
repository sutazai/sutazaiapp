version: '3.8'

# Resource optimization overrides
x-agent-optimized: &agent-optimized
  deploy:
    resources:
      limits:
        cpus: '0.3'
        memory: 384M
      reservations:
        cpus: '0.1'
        memory: 128M
  restart: unless-stopped
  healthcheck:
    interval: 60s
    timeout: 30s
    retries: 5
    start_period: 90s

services:
  # Core services optimization
  postgres:
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M
  
  neo4j:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 3G
        reservations:
          cpus: '1'
          memory: 1G
  
  ollama:
    deploy:
      resources:
        limits:
          cpus: '8'
          memory: 16G
        reservations:
          cpus: '4'
          memory: 8G
  
  redis:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
