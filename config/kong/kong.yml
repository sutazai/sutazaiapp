_format_version: "3.0"
_transform: true

services:
  # Core backend service  
  - name: backend
    url: http://sutazai-backend:8000
    routes:
      - name: backend-health
        paths: ["/health"]
        strip_path: false
      - name: backend-api
        paths: ["/api"]
        strip_path: false
      - name: backend-docs
        paths: ["/docs", "/redoc"]
        strip_path: false

  # Frontend UI service
  - name: frontend
    url: http://sutazai-frontend:8501
    routes:
      - name: frontend-ui
        paths: ["/app"]
        strip_path: true

  # Ollama LLM service
  - name: ollama
    url: http://sutazai-ollama:11434
    routes:
      - name: ollama-api
        paths: ["/ollama"]
        strip_path: true

  # Monitoring services (actually running)
  - name: grafana
    url: http://sutazai-grafana:3000
    routes:
      - name: grafana-ui
        paths: ["/grafana"]
        strip_path: true

  - name: prometheus
    url: http://sutazai-prometheus:9090
    routes:
      - name: prometheus-ui
        paths: ["/prometheus"]
        strip_path: true

  - name: alertmanager
    url: http://sutazai-alertmanager:9093
    routes:
      - name: alertmanager-ui
        paths: ["/alertmanager"]
        strip_path: true

  # Vector databases (actually running)
  - name: qdrant
    url: http://sutazai-qdrant:6333
    routes:
      - name: qdrant-api
        paths: ["/qdrant"]
        strip_path: true

  - name: faiss
    url: http://sutazai-faiss:8000
    routes:
      - name: faiss-api
        paths: ["/faiss"]
        strip_path: true

  # Health check endpoint for Kong itself
  - name: kong-status
    url: http://sutazai-backend:8000
    routes:
      - name: kong-health
        paths: ["/status"]
        strip_path: false
        methods: ["GET"]

plugins:
  - name: cors
    config:
      origins:
        - "*"
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
      headers: ["*"]
      credentials: true
      preflight_continue: false
