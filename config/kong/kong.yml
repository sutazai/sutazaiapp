_format_version: "3.0"
_transform: true

services:
  - name: consul-service-discovery
    url: http://consul:8500/v1/catalog/service
    routes:
      - name: consul-route
        paths:
          - /consul
        strip_path: true
        
  # Example service that can be discovered through Consul
  - name: upstream-services
    host: consul.service.consul
    port: 8500
    protocol: http
    routes:
      - name: service-discovery-route
        paths:
          - /services
        methods:
          - GET
          - POST
          - PUT
          - DELETE

# Plugins for service mesh capabilities
plugins:
  - name: prometheus
    config:
      per_consumer: false
      
  - name: request-transformer
    config:
      add:
        headers:
          - X-Service-Mesh:sutazaiapp
          
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-Type
        - Authorization
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600