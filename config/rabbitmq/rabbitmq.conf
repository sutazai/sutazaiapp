# RabbitMQ Configuration for SutazAI Service Mesh
# Production-ready configuration with clustering and security

# Management plugin configuration
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# Main broker configuration
listeners.tcp.default = 5672
num_acceptors.tcp = 10
handshake_timeout = 10000
vm_memory_high_watermark = 0.4
disk_free_limit.absolute = 2GB

# Clustering configuration
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config
cluster_formation.classic_config.nodes.1 = rabbit@rabbitmq-1
cluster_formation.classic_config.nodes.2 = rabbit@rabbitmq-2
cluster_formation.classic_config.nodes.3 = rabbit@rabbitmq-3
cluster_name = sutazai-rabbitmq-cluster
cluster_partition_handling = pause_minority

# Federation and shovel plugins
loopback_users = none
default_user = admin
default_pass = adminpass

# TLS/SSL configuration (production ready)
ssl_options.cacertfile = /etc/ssl/certs/ca-certificates.crt
ssl_options.certfile = /etc/ssl/certs/server.pem
ssl_options.keyfile = /etc/ssl/private/server.key
ssl_options.verify = verify_peer
ssl_options.fail_if_no_peer_cert = true

# Performance tuning
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.exit_on_close = false

# Memory and disk management
vm_memory_calculation_strategy = rss
total_memory_available_override_value = 2147483648

# Queue configuration
default_vhost = /
default_user_tags.administrator = true
default_permissions.configure = .*
default_permissions.read = .*
default_permissions.write = .*

# Log configuration
log.console = true
log.console.level = info
log.file = /var/log/rabbitmq/rabbit.log
log.file.level = info
log.file.rotation.count = 10
log.file.rotation.size = 10485760

# Message TTL and retention
message_store_index_embed_msgs_below = 4096
backing_queue_module = rabbit_variable_queue

# Heartbeat configuration
heartbeat = 60

# Channel configuration
channel_max = 2047
channel_operation_timeout = 15000

# Queue master locator
queue_master_locator = min-masters

# Statistics collection
collect_statistics = coarse
collect_statistics_interval = 5000

# Auth mechanisms
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN