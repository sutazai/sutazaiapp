# ML Services CPU Optimization Override
version: '3.8'

services:
  pytorch:
    environment:
      - PYTORCH_CPU_ONLY=true
      - OMP_NUM_THREADS=4
      - MKL_NUM_THREADS=4
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2048M

  tensorflow:
    environment:
      - TF_CPP_MIN_LOG_LEVEL=2
      - TF_ENABLE_ONEDNN_OPTS=1
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2048M

  jax:
    environment:
      - JAX_PLATFORM_NAME=cpu
      - XLA_FLAGS=--xla_cpu_multi_thread_eigen=true
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M

  fsdp:
    environment:
      - TORCH_DISTRIBUTED_BACKEND=gloo
      - WORLD_SIZE=1
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2048M
