# Docker API Fix for Build Cache Pruning
# Hardware Resource Optimizer Agent

--- a/app.py
+++ b/app.py
@@ -1060,7 +1060,11 @@ class HardwareResourceOptimizerAgent(BaseAgent):
             # Prune build cache
             try:
-                self.docker_client.api.prune_build_cache()
+                # Use the correct API method for build cache pruning
+                pruned_builds = self.docker_client.api.prune_builds()
+                if pruned_builds.get('SpaceReclaimed', 0) > 0:
+                    space_mb = pruned_builds['SpaceReclaimed'] / (1024 * 1024)
+                    actions_taken.append(f"Pruned Docker build cache - freed {space_mb:.1f}MB")
+                else:
                 actions_taken.append("Pruned Docker build cache")
             except Exception as e:
                 actions_taken.append(f"Could not prune build cache: {e}")

# Alternative implementation if prune_builds() is not available:
# Replace the try block with:
#             try:
#                 # Fallback to system prune for build cache
#                 pruned = self.docker_client.api.prune_system()
#                 if pruned.get('SpaceReclaimed', 0) > 0:
#                     space_mb = pruned['SpaceReclaimed'] / (1024 * 1024)
#                     actions_taken.append(f"Pruned Docker system cache - freed {space_mb:.1f}MB")
#                 else:
#                     actions_taken.append("Pruned Docker system cache")
#             except Exception as e:
#                 actions_taken.append(f"Could not prune build cache: {e}")