# SutazAI Alpine Agent Template - Edge Optimized
# Template for all agent services with 50%+ size reduction
# Multi-stage build with production hardening
# Author: Edge Computing Optimization Specialist
# Date: August 10, 2025

FROM sutazai-python-alpine-optimized:latest as base

# Agent-specific dependencies (if any)
# COPY requirements.txt /tmp/agent-requirements.txt
# RUN if [ -f /tmp/agent-requirements.txt ]; then \
#       pip install --no-cache-dir --compile -r /tmp/agent-requirements.txt \
#       && rm /tmp/agent-requirements.txt \
#       && find /opt/venv -type d -name '__pycache__' -exec rm -rf {} + || true \
#       && find /opt/venv -name '*.pyc' -delete; \
#     fi

# Copy application code (minimized)
COPY app.py .
# COPY shared/ ./shared/  # Only if needed
# COPY config/ ./config/  # Only if needed

# Agent-specific environment variables
# ENV SERVICE_PORT=8080 \
#     AGENT_ID=template-agent \
#     AGENT_NAME="Template Agent" \
#     AGENT_TYPE=template

# Optimized health check
HEALTHCHECK --interval=60s --timeout=10s --start-period=30s --retries=2 \
    CMD curl -f http://localhost:${SERVICE_PORT:-8080}/health || exit 1

# Expose port
EXPOSE ${SERVICE_PORT:-8080}

# Already non-root user from base image
# USER appuser

# Optimized startup
CMD ["python", "-u", "app.py"]

# Edge computing labels
LABEL edge.optimized="true" \
      edge.size.target="<200MB" \
      edge.resources.minimal="true"