fromfastapiimportFastAPI,File,UploadFileimportfitz#PyMuPDFimportmammothimportpytesseractimportiofromPILimportImagefromfastapiimportHTTPExceptionimportloggingapp=FastAPI()logger=logging.getLogger(__name__)@app.post("/analyze")asyncdefanalyze_document(file:UploadFile):try:iffile.content_type=="application/pdf":pdf=fitz.open(stream=awaitfile.read())return{"pages":len(pdf),"content":"\n".join([page.get_text()forpageinpdf])}eliffile.content_type=="application/vnd.openxmlformats-officedocument.wordprocessingml.document":result=mammoth.extract_raw_text(awaitfile.read())return{"content":result.value}eliffile.content_type.startswith("image/"):image=Image.open(io.BytesIO(awaitfile.read()))#PreprocessforbetterOCRaccuracyimage=image.convert('L')#Grayscaleconversionimage=image.point(lambdax:0ifx<128else255)#Binarizationreturn{"content":pytesseract.image_to_string(image)}exceptExceptionase:logger.error(f"Documentprocessingfailed:{str(e)}")raiseHTTPException(status_code=500,detail="Documentprocessingerror")asyncdefprocess_document(file):try:withImage.open(io.BytesIO(awaitfile.read()))asimage:image=image.convert('L')return{"content":pytesseract.image_to_string(image)}exceptExceptionase:logging.error(f"Documentprocessingfailed:{str(e)}")raiseHTTPException(status_code=500,detail="Documentprocessingerror")