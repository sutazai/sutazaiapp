apiVersion: mcp/v1
kind: MCPContainer
metadata:
  name: mcp-postgres
  labels:
    mcp.service: postgres
    mcp.tier: data
spec:
  image: ghcr.io/modelcontextprotocol/postgres:latest
  container_name: mcp-postgres
  environment:
    POSTGRES_HOST: host.docker.internal
    POSTGRES_PORT: "10000"
    POSTGRES_USER: sutazai_user
    POSTGRES_DB: sutazai_main
    POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
  ports:
    "13001": "3000"  # MCP protocol port
  volumes:
    postgres_mcp_data: /data
  secrets:
    - postgres_password
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 30s
  restart_policy: unless-stopped
  resources:
    limits:
      cpus: "1.0"
      memory: 512M
    reservations:
      cpus: "0.25"
      memory: 128M
  networks:
    - sutazai-dind-internal
  labels:
    mcp.managed: "true"
    mcp.protocol: "stdio"
    mcp.integration: "postgres"