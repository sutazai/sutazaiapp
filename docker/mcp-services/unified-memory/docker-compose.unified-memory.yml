version: '3.8'

# Unified Memory Service - Phase 2 Consolidation
# Replaces mcp-extended-memory and mcp-memory-bank-mcp

services:
  mcp-unified-memory:
    build:
      context: .
      dockerfile: Dockerfile
    image: sutazai-mcp-unified-memory:latest
    container_name: mcp-unified-memory
    environment:
      - MCP_SERVICE=unified-memory
      - PYTHONPATH=/opt/memory
      - MCP_HOST=0.0.0.0
      - MCP_PORT=3009
      - SQLITE_PATH=/var/lib/mcp/unified_memory.db
      - VECTOR_STORE_ENABLED=true
      - CACHE_ENABLED=true
      - MAX_MEMORY_SIZE=2097152  # 2MB
    ports:
      - "3009:3009"
    volumes:
      - mcp-unified-memory-data:/var/lib/mcp
      - mcp-memory-vector-store:/var/lib/vector
      - mcp-logs:/var/log/mcp
    networks:
      - mcp-bridge
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3009/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    labels:
      - "mcp.service=unified-memory"
      - "mcp.consolidation=phase-2"
      - "mcp.replaces=extended-memory,memory-bank-mcp"

volumes:
  mcp-unified-memory-data:
    driver: local
  mcp-memory-vector-store:
    driver: local
  mcp-logs:
    driver: local

networks:
  mcp-bridge:
    external: true