networks:
  sutazai-network:
    external: true
    name: sutazai-network
services:
  kong:
    image: kong:3.5
    container_name: sutazai-kong-test
    mem_limit: 512M
    cpus: 0.5
    mem_reservation: 128M
    environment:
      KONG_DATABASE: 'off'
      KONG_DECLARATIVE_CONFIG: /etc/kong/kong.yml
      KONG_PROXY_LISTEN: 0.0.0.0:8000
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
      KONG_LOG_LEVEL: notice
      KONG_NGINX_WORKER_PROCESSES: '2'
      KONG_NGINX_WORKER_CONNECTIONS: '1024'
    healthcheck:
      test:
      - CMD-SHELL
      - ps aux | grep '[k]ong' > /dev/null || exit 1
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
    - sutazai-network
    ports:
    - 10005:8000
    - 10015:8001
    restart: unless-stopped
    volumes:
    - ./config/kong/kong.yml:/etc/kong/kong.yml:ro
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
