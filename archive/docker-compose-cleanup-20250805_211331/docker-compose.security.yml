# Security-hardened Docker Compose override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.security.yml up
version: '3.8'

services:
  # Remove privileged mode from hardware optimizer where possible
  hardware-resource-optimizer:
    privileged: false
    # Add specific capabilities instead
    cap_add:
      - SYS_ADMIN
      - SYS_PTRACE
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    
  # Secure cadvisor configuration
  cadvisor:
    privileged: false
    cap_add:
      - SYS_ADMIN
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
    read_only: true
    
  # Add security context to all services
  backend:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
      
  frontend:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m

  postgres:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
      
  redis:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
    read_only: true
    
  neo4j:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
      
  ollama:
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default
