version: '3.8'

# Health check fixes for all agent containers
x-agent-health-check: &agent-health-check
  healthcheck:
    test: ["CMD", "python3", "-c", "import socket; s=socket.socket(); s.settimeout(5); exit(0 if s.connect_ex(('localhost', 8080))==0 else 1)"]
    interval: 60s
    timeout: 30s
    retries: 5
    start_period: 120s
    
networks:
  sutazai-network:
    external: true

services:
  # Apply health check fix to commonly failing containers
  ai-system-validator:
    <<: *agent-health-check
    
  ai-testing-qa-validator:
    <<: *agent-health-check
    
  # Phase 3 services with health fixes
  data-analysis-engineer-phase3:
    <<: *agent-health-check
    
  dify-automation-specialist-phase3:
    <<: *agent-health-check
    
  awesome-code-ai-phase3:
    <<: *agent-health-check
    
  distributed-computing-architect-phase3:
    <<: *agent-health-check
    
  federated-learning-coordinator-phase3:
    <<: *agent-health-check
    
  garbage-collector-coordinator-phase3:
    <<: *agent-health-check
    
  edge-computing-optimizer-phase3:
    <<: *agent-health-check
    
  finrobot-phase3:
    <<: *agent-health-check
    
  flowiseai-flow-manager-phase3:
    <<: *agent-health-check
    
  data-pipeline-engineer-phase3:
    <<: *agent-health-check
    
  episodic-memory-engineer-phase3:
    <<: *agent-health-check
    
  gradient-compression-specialist-phase3:
    <<: *agent-health-check
    
  explainable-ai-specialist-phase3:
    <<: *agent-health-check
