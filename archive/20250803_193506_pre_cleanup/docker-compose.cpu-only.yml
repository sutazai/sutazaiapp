# CPU-Only Override Configuration for SutazAI
# This file provides CPU-optimized overrides for resource-constrained environments
# Usage: docker compose -f docker-compose.yml -f docker-compose.cpu-only.yml up

version: '3.8'

services:
  # Reduce resource limits for CPU-only deployment
  ollama:
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
    environment:
      - OLLAMA_NUM_PARALLEL=1
      - OLLAMA_MAX_LOADED_MODELS=1

  backend:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
    environment:
      - MAX_WORKERS=2
      - ENABLE_GPU=false

  postgres:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  redis:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 1G

  neo4j:
    environment:
      - NEO4J_dbms_memory_heap_max__size=1G
      - NEO4J_dbms_memory_pagecache_size=512M
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  # Disable resource-intensive services in CPU-only mode
  tensorflow:
    deploy:
      replicas: 0

  pytorch:
    deploy:
      replicas: 0

  jax:
    deploy:
      replicas: 0