[pytest]
# Pytest Configuration for SutazAI Backend Tests
# Created: 2025-11-16 00:00:00 UTC
# Purpose: Configure pytest for async tests, coverage, and comprehensive backend testing

# Minimum pytest version required
minversion = 7.0

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*

# Test paths
testpaths = tests

# Async test configuration - auto mode for pytest-asyncio
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Console output options
console_output_style = progress
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File logging
log_file = test-results/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Test output options
addopts =
    --verbose
    --tb=short
    --strict-markers
    --strict-config
    --color=yes
    --durations=10
    --maxfail=50
    -ra

# Coverage options (when using pytest-cov)
# Run with: pytest --cov=app --cov-report=html --cov-report=term-missing
[coverage:run]
source = app
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */.venv/*

[coverage:report]
precision = 2
show_missing = true
skip_covered = false

# Custom markers for test categorization
markers =
    asyncio: mark test as async (pytest-asyncio)
    slow: mark test as slow running
    integration: mark test as integration test
    unit: mark test as unit test
    database: mark test requiring database connection
    redis: mark test requiring Redis connection
    neo4j: mark test requiring Neo4j connection
    rabbitmq: mark test requiring RabbitMQ connection
    consul: mark test requiring Consul connection
    kong: mark test requiring Kong connection
    chromadb: mark test requiring ChromaDB connection
    qdrant: mark test requiring Qdrant connection
    faiss: mark test requiring FAISS connection
    auth: mark test related to authentication
    jwt: mark test related to JWT tokens
    api: mark test for API endpoints
    websocket: mark test for WebSocket functionality
    vector: mark test for vector database operations
    cache: mark test for caching functionality
    messaging: mark test for message queue operations
    graph: mark test for graph database operations
    service_discovery: mark test for service discovery
    gateway: mark test for API gateway functionality
    monitoring: mark test for monitoring and metrics
    security: mark test for security features
    performance: mark test for performance validation
    load: mark test for load testing
    e2e: mark test as end-to-end workflow test

# Filter warnings
filterwarnings =
    error
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    ignore:.*ssl.PROTOCOL_TLS.*:DeprecationWarning
    ignore:.*unclosed.*:ResourceWarning

# Timeout for tests (in seconds) - prevents hanging tests
timeout = 300
timeout_method = thread
