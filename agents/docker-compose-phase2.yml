# SutazAI Platform - Phase 2 Lightweight Agents
# All configured for local LLM with Ollama/TinyLlama
# Target: ~3GB RAM total

services:
  # AutoGPT - Autonomous Task Execution
  autogpt:
    container_name: sutazai-autogpt
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y git curl &&
             pip install --no-cache-dir litellm fastapi uvicorn pyyaml &&
             python /app/autogpt_local.py"
    ports:
      - "11102:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_BASE_URL=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/autogpt_local.py:/app/autogpt_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
      - ./workspaces/autogpt:/workspace:rw
    mem_limit: 512m
    cpus: 0.5
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5
      start_period: 120s

  # LocalAGI - Autonomous AI Orchestration
  localagi:
    container_name: sutazai-localagi
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir fastapi uvicorn requests &&
             python /app/localagi_local.py"
    ports:
      - "11103:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_HOST=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/localagi_local.py:/app/localagi_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 384m
    cpus: 0.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # Agent Zero - Autonomous Agent Framework
  agentzero:
    container_name: sutazai-agentzero
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir fastapi uvicorn litellm &&
             python /app/agentzero_local.py"
    ports:
      - "11105:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_API_BASE=http://172.20.0.1:11434
      - LLM_MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/agentzero_local.py:/app/agentzero_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 384m
    cpus: 0.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # BigAGI - Chat Interface
  bigagi:
    container_name: sutazai-bigagi
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir fastapi uvicorn websockets &&
             python /app/bigagi_local.py"
    ports:
      - "11106:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_BASE_URL=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/bigagi_local.py:/app/bigagi_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 384m
    cpus: 0.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # Semgrep - Code Security Analysis
  semgrep:
    container_name: sutazai-semgrep
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir semgrep fastapi uvicorn &&
             python /app/semgrep_local.py"
    ports:
      - "11801:8000"
    networks:
      - sutazai-network
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/semgrep_local.py:/app/semgrep_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
      - ./workspaces/semgrep:/workspace:rw
    mem_limit: 512m
    cpus: 0.5
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # AutoGen - Agent Configuration
  autogen:
    container_name: sutazai-autogen
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir pyautogen fastapi uvicorn &&
             python /app/autogen_local.py"
    ports:
      - "11203:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_BASE_URL=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/autogen_local.py:/app/autogen_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 384m
    cpus: 0.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # Browser Use - Web Automation
  browseruse:
    container_name: sutazai-browseruse
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl chromium-driver &&
             pip install --no-cache-dir playwright fastapi uvicorn &&
             python /app/browseruse_local.py"
    ports:
      - "11703:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_BASE_URL=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/browseruse_local.py:/app/browseruse_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 512m
    cpus: 0.5
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

  # Skyvern - Browser Automation
  skyvern:
    container_name: sutazai-skyvern
    image: python:3.11-slim
    working_dir: /app
    command: |
      sh -c "apt-get update && apt-get install -y curl &&
             pip install --no-cache-dir selenium fastapi uvicorn &&
             python /app/skyvern_local.py"
    ports:
      - "11702:8000"
    networks:
      - sutazai-network
    environment:
      - OLLAMA_BASE_URL=http://172.20.0.1:11434
      - MODEL=tinyllama
      - PYTHONUNBUFFERED=1
    volumes:
      - ./wrappers/skyvern_local.py:/app/skyvern_local.py:ro
      - ./wrappers/base_agent_wrapper.py:/app/base_agent_wrapper.py:ro
    mem_limit: 384m
    cpus: 0.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 60s
      timeout: 20s
      retries: 5

networks:
  sutazai-network:
    external: true
    name: sutazaiapp_sutazai-network

# Phase 2 Resource Summary:
# - AutoGPT: 512MB RAM, 0.5 CPU
# - LocalAGI: 384MB RAM, 0.4 CPU
# - AgentZero: 384MB RAM, 0.4 CPU
# - BigAGI: 384MB RAM, 0.4 CPU
# - Semgrep: 512MB RAM, 0.5 CPU
# - AutoGen: 384MB RAM, 0.4 CPU
# - Browser Use: 512MB RAM, 0.5 CPU
# - Skyvern: 384MB RAM, 0.4 CPU
# Total: ~3.3GB RAM, 3.6 CPUs