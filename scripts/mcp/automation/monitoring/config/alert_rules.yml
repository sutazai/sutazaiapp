# Alert rules for MCP Automation Monitoring

groups:
  - name: mcp_server_alerts
    interval: 30s
    rules:
      - alert: MCPServerDown
        expr: mcp_server_up == 0
        for: 2m
        labels:
          severity: critical
          component: mcp_server
        annotations:
          summary: "MCP Server {{ $labels.server_name }} is down"
          description: "MCP Server {{ $labels.server_name }} has been unavailable for more than 2 minutes"

      - alert: MCPServerHighLatency
        expr: histogram_quantile(0.95, rate(mcp_server_latency_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
          component: mcp_server
        annotations:
          summary: "High latency for MCP Server {{ $labels.server_name }}"
          description: "95th percentile latency for {{ $labels.server_name }} is {{ $value }}s"

      - alert: MCPServerHighErrorRate
        expr: rate(mcp_server_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: mcp_server
        annotations:
          summary: "High error rate for MCP Server {{ $labels.server_name }}"
          description: "Error rate for {{ $labels.server_name }} is {{ $value }} errors/sec"

  - name: automation_alerts
    interval: 30s
    rules:
      - alert: AutomationWorkflowFailure
        expr: rate(mcp_automation_executions_total{status="failed"}[5m]) > 0.05
        for: 5m
        labels:
          severity: error
          component: automation
        annotations:
          summary: "High failure rate for workflow {{ $labels.workflow_name }}"
          description: "Workflow {{ $labels.workflow_name }} has failure rate of {{ $value }}"

      - alert: AutomationQueueBacklog
        expr: mcp_automation_queue_size > 100
        for: 10m
        labels:
          severity: warning
          component: automation
        annotations:
          summary: "Large queue backlog for {{ $labels.workflow_name }}"
          description: "Queue size for {{ $labels.workflow_name }} is {{ $value }}"

      - alert: AutomationSLAViolation
        expr: mcp_automation_sla_compliance_ratio < 0.95
        for: 5m
        labels:
          severity: error
          component: automation
        annotations:
          summary: "SLA violation for {{ $labels.workflow_name }}"
          description: "SLA compliance for {{ $labels.workflow_name }} is {{ $value }}"

  - name: system_alerts
    interval: 30s
    rules:
      - alert: HighCPUUsage
        expr: mcp_system_cpu_percent > 80
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}%"

      - alert: HighMemoryUsage
        expr: mcp_system_memory_percent > 85
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ $value }}%"

      - alert: DiskSpaceCritical
        expr: mcp_system_disk_percent > 90
        for: 5m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "Critical disk space on {{ $labels.mount_point }}"
          description: "Disk usage on {{ $labels.mount_point }} is {{ $value }}%"

  - name: collector_alerts
    interval: 30s
    rules:
      - alert: MetricsCollectorDown
        expr: up{job="mcp-monitoring"} == 0
        for: 2m
        labels:
          severity: critical
          component: monitoring
        annotations:
          summary: "Metrics collector is down"
          description: "MCP metrics collector has been unavailable for more than 2 minutes"

      - alert: HighCollectorErrors
        expr: rate(mcp_collector_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: monitoring
        annotations:
          summary: "High error rate in metrics collection"
          description: "Metrics collector error rate is {{ $value }} errors/sec"

  - name: api_alerts
    interval: 30s
    rules:
      - alert: APIEndpointDown
        expr: probe_success{job="blackbox"} == 0
        for: 2m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "API endpoint {{ $labels.instance }} is down"
          description: "API endpoint {{ $labels.instance }} has been unavailable for more than 2 minutes"

      - alert: APIHighLatency
        expr: probe_duration_seconds{job="blackbox"} > 2
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "High latency for API endpoint {{ $labels.instance }}"
          description: "API endpoint {{ $labels.instance }} response time is {{ $value }}s"